# æ··åˆéƒ¨ç½²æŒ‡å— - åç«¯Docker + å‰ç«¯Nginx

## ğŸ¯ éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è¯·æ±‚      â”‚â”€â”€â”€â–¶â”‚   Nginx (Host)   â”‚â”€â”€â”€â–¶â”‚ Docker Backend  â”‚
â”‚                 â”‚    â”‚  é™æ€æ–‡ä»¶æœåŠ¡    â”‚    â”‚   Flask API     â”‚
â”‚                 â”‚    â”‚  åå‘ä»£ç†        â”‚    â”‚   ç«¯å£: 5000    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. éƒ¨ç½²åç«¯åˆ°Docker
```bash
chmod +x deploy-backend.sh
./deploy-backend.sh
```

### 2. é…ç½®Nginx
```bash
# å¤‡ä»½ç°æœ‰é…ç½®
sudo cp /etc/nginx/sites-available/home.name666.top /etc/nginx/sites-available/home.name666.top.backup

# å‚è€ƒ nginx-site.conf æ›´æ–°ä½ çš„é…ç½®
sudo nano /etc/nginx/sites-available/home.name666.top

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½Nginx
sudo systemctl reload nginx
```

## ğŸ“ å…³é”®é…ç½®æ–‡ä»¶

### docker-compose.backend-only.yml
- åªéƒ¨ç½²åç«¯Flaskåº”ç”¨
- ç«¯å£ç»‘å®šåˆ° `127.0.0.1:5000`
- èµ„æºé™åˆ¶ï¼šCPU 0.5æ ¸ï¼Œå†…å­˜256M

### nginx-site.conf
- é™æ€æ–‡ä»¶ç›´æ¥ç”±NginxæœåŠ¡
- APIè¯·æ±‚ä»£ç†åˆ°Dockeråç«¯
- æ€§èƒ½ä¼˜åŒ–é…ç½®

## ğŸ”§ Nginxé…ç½®è¦ç‚¹

### å…³é”®é…ç½®é¡¹
```nginx
# ç½‘ç«™æ ¹ç›®å½• - ä¿®æ”¹ä¸ºä½ çš„å®é™…è·¯å¾„
root /path/to/your/homepage/frontend;

# APIä»£ç†åˆ°Dockeråç«¯
location /api/ {
    proxy_pass http://127.0.0.1:5000/;
    # ... å…¶ä»–ä»£ç†é…ç½®
}
```

### éœ€è¦ä¿®æ”¹çš„åœ°æ–¹
1. **rootè·¯å¾„**: æ”¹ä¸ºä½ çš„å‰ç«¯æ–‡ä»¶å®é™…è·¯å¾„
2. **server_name**: ç¡®è®¤åŸŸåæ­£ç¡®
3. **SSLé…ç½®**: å¦‚æœæœ‰HTTPSè¯ä¹¦ï¼Œå–æ¶ˆæ³¨é‡Šç›¸å…³é…ç½®

## âš¡ æ€§èƒ½ä¼˜åŠ¿

### åç«¯DockeråŒ–ä¼˜åŠ¿
- **èµ„æºéš”ç¦»**: é™åˆ¶CPUå’Œå†…å­˜ä½¿ç”¨
- **æ˜“äºç®¡ç†**: å®¹å™¨åŒ–éƒ¨ç½²ï¼Œä¾¿äºæ›´æ–°å’Œå›æ»š
- **ç¯å¢ƒä¸€è‡´**: é¿å…ç¯å¢ƒå·®å¼‚é—®é¢˜

### å‰ç«¯Nginxç›´æ¥æœåŠ¡ä¼˜åŠ¿
- **é«˜æ€§èƒ½**: ç›´æ¥æ–‡ä»¶ç³»ç»Ÿè®¿é—®ï¼Œæ— å®¹å™¨å¼€é”€
- **ä½å»¶è¿Ÿ**: å‡å°‘ç½‘ç»œå±‚çº§
- **ç®€å•é…ç½®**: åˆ©ç”¨ç°æœ‰Nginxé…ç½®

## ğŸ“Š ç›‘æ§å’Œç®¡ç†

### åç«¯æœåŠ¡ç®¡ç†
```bash
# æŸ¥çœ‹çŠ¶æ€
docker-compose -f docker-compose.backend-only.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.backend-only.yml logs -f

# é‡å¯åç«¯
docker-compose -f docker-compose.backend-only.yml restart

# åœæ­¢åç«¯
docker-compose -f docker-compose.backend-only.yml down
```

### å¥åº·æ£€æŸ¥
```bash
# åç«¯å¥åº·æ£€æŸ¥
curl http://127.0.0.1:5000/api/health

# å‰ç«¯è®¿é—®æµ‹è¯•
curl http://home.name666.top/health
```

## ğŸ”’ å®‰å…¨é…ç½®

### åç«¯å®‰å…¨
- åªç»‘å®šåˆ°æœ¬åœ°IP (127.0.0.1)
- érootç”¨æˆ·è¿è¡Œ
- èµ„æºé™åˆ¶é˜²æ­¢èµ„æºè€—å°½

### å‰ç«¯å®‰å…¨
- å®‰å…¨å¤´é…ç½®
- æ•æ„Ÿæ–‡ä»¶è®¿é—®é™åˆ¶
- HTTPSæ”¯æŒï¼ˆå¯é€‰ï¼‰

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **åç«¯è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
   docker ps | grep homepage-backend
   
   # æ£€æŸ¥ç«¯å£ç›‘å¬
   netstat -tulpn | grep :5000
   
   # æŸ¥çœ‹åç«¯æ—¥å¿—
   docker logs homepage-backend
   ```

2. **Nginxé…ç½®é”™è¯¯**
   ```bash
   # æµ‹è¯•é…ç½®è¯­æ³•
   sudo nginx -t
   
   # æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
   sudo tail -f /var/log/nginx/error.log
   ```

3. **æƒé™é—®é¢˜**
   ```bash
   # æ£€æŸ¥å‰ç«¯æ–‡ä»¶æƒé™
   ls -la /path/to/your/homepage/frontend/
   
   # ä¿®å¤æƒé™ï¼ˆå¦‚æœéœ€è¦ï¼‰
   sudo chown -R www-data:www-data /path/to/your/homepage/frontend/
   ```

## ğŸ“ˆ æ‰©å±•å»ºè®®

### ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–
1. **SSLè¯ä¹¦**: é…ç½®HTTPS
2. **æ—¥å¿—è½®è½¬**: é…ç½®æ—¥å¿—è‡ªåŠ¨æ¸…ç†
3. **ç›‘æ§**: æ·»åŠ Prometheus/Grafanaç›‘æ§
4. **å¤‡ä»½**: å®šæœŸå¤‡ä»½é…ç½®å’Œæ•°æ®

### é«˜å¯ç”¨éƒ¨ç½²
1. **å¤šåç«¯å®ä¾‹**: æ‰©å±•Dockeråç«¯å®ä¾‹
2. **è´Ÿè½½å‡è¡¡**: Nginx upstreamé…ç½®
3. **å¥åº·æ£€æŸ¥**: è‡ªåŠ¨æ•…éšœè½¬ç§»
